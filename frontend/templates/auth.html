{# frontend/templates/auth.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Sign In / Sign Up â€” Tourista{% endblock %}

{% block extra_css %}
<style>
  .auth-wrapper {
    display: flex;
    min-height: 100vh;
    font-family: 'Segoe UI', sans-serif;
  }

  /* LEFT HERO SECTION */
  .auth-left {
    flex: 1;
    position: relative;
    background: url("{% static 'images/bg.jpg' %}") center/cover no-repeat;
    background-blend-mode: overlay;
    background-color: rgba(44, 62, 80, 0.75);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 2rem;
    color: #fff;
  }

  .auth-left::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
  }

  .auth-left .hero-text {
    position: relative;
    z-index: 1;
  }

  .auth-left img.logo {
    width: 120px;
    margin-bottom: 1rem;
    position: relative;
    z-index: 1;
  }

  .auth-left h1 {
    font-size: 2.25rem;
    margin-bottom: .75rem;
    text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.7);
  }

  .auth-left p {
    font-size: 1.2rem;
    max-width: 320px;
    color: #f3f3f3;
    text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.7);
  }

  /* RIGHT FORM SECTION */
  .auth-right {
    flex: 1;
    background: #f7f7f7;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .toggle-auth-container {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: 90%;
    max-width: 420px;
    padding: 2rem;
  }

  /* TOGGLE SWITCH BUTTONS */
  .toggle-buttons {
    display: flex;
    margin-bottom: 2rem;
    background: #f0f0f0;
    border-radius: 8px;
    padding: 4px;
  }

  .toggle-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    background: transparent;
    color: #666;
  }

  .toggle-btn.active {
    background: #3498db;
    color: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  /* FORM STYLES */
  .auth-form {
    display: none;
  }

  .auth-form.active {
    display: block;
  }

  .auth-form h2 {
    margin-bottom: 1.5rem;
    font-weight: 600;
    color: #333;
    text-align: center;
  }

  /* FLOATING LABELS */
  .form-group {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .form-input {
    width: 100%;
    height: 50px;
    padding: 16px 12px 4px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    transition: all 0.3s ease;
    color: #333;
  }

  .form-input:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
  }

  .form-label {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
    pointer-events: none;
    transition: all 0.3s ease;
  }

  .form-input:focus~.form-label,
  .form-input:not(:placeholder-shown)~.form-label {
    top: 8px;
    transform: translateY(0);
    font-size: 12px;
    color: #3498db;
    background: #fff;
    padding: 0 4px;
  }

  /* TRAVEL STYLE DROPDOWN */
  .form-group select.form-input {
    appearance: none;
    background: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e") no-repeat right 12px center/16px;
  }

  /* BUTTON STYLES */
  .btn-primary {
    background: #3498db;
    border: none;
    width: 100%;
    font-weight: 600;
    padding: 12px;
    font-size: 16px;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .btn-primary:hover {
    background: #2980b9;
  }

  /* ERROR MESSAGES */
  .text-danger.small {
    margin-top: 4px;
    font-size: 12px;
    color: #e74c3c;
  }

  /* MOBILE RESPONSIVE */
  @media (max-width: 768px) {
    .auth-wrapper {
      flex-direction: column;
    }

    .auth-left,
    .auth-right {
      width: 100%;
      flex: none;
    }

    .auth-left {
      min-height: 250px;
      padding: 1rem;
    }

    .auth-left h1 {
      font-size: 1.75rem;
    }

    .toggle-auth-container {
      width: 100%;
      padding: 1.5rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrapper">

  <!-- LEFT HERO -->
  <div class="auth-left">
    <div class="hero-text">
      <img src="{% static 'images/tourista_logo.png' %}" alt="Tourista Logo" class="logo">
      <h1>Welcome to Tourista</h1>
      <p>Plan your perfect journey. Sign in or create an account to begin!</p>
    </div>
  </div>

  <!-- RIGHT FORM SECTION -->
  <div class="auth-right">
    <div class="toggle-auth-container">

      <!-- TOGGLE BUTTONS -->
      <div class="toggle-buttons">
        <button id="showLoginBtn" class="toggle-btn active">Sign In</button>
        <button id="showRegisterBtn" class="toggle-btn">Sign Up</button>
      </div>

      <!-- SIGN IN FORM -->
      <div id="loginForm" class="auth-form active">
        <h2>Welcome Back!</h2>
        <form method="post" action="{% url 'auth' %}">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="login">

          {% if login_form.non_field_errors %}
          <div class="alert alert-danger mb-3">{{ login_form.non_field_errors.0 }}</div>
          {% endif %}

          <div class="form-group">
            <input type="text" class="form-input" name="username" placeholder=" " required
              value="{{ login_form.username.value|default:'' }}">
            <label class="form-label">Username</label>
            {% if login_form.username.errors %}
            <div class="text-danger small">{{ login_form.username.errors.0 }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            <input type="password" class="form-input" name="password" placeholder=" " required>
            <label class="form-label">Password</label>
            {% if login_form.password.errors %}
            <div class="text-danger small">{{ login_form.password.errors.0 }}</div>
            {% endif %}
          </div>

          <button type="submit" class="btn btn-primary">Sign In</button>
        </form>
      </div>

      <!-- SIGN UP FORM -->
      <div id="registerForm" class="auth-form">
        <h2>Create Account</h2>
        <form method="post" action="{% url 'auth' %}">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="register">

          {% if register_form.non_field_errors %}
          <div class="alert alert-danger mb-3">{{ register_form.non_field_errors.0 }}</div>
          {% endif %}

          <div class="form-group">
            <input type="text" class="form-input" name="username" placeholder=" " required
              value="{{ register_form.username.value|default:'' }}">
            <label class="form-label">Username</label>
            {% if register_form.username.errors %}
            <div class="text-danger small">{{ register_form.username.errors.0 }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            <input type="email" class="form-input" name="email" placeholder=" " required
              value="{{ register_form.email.value|default:'' }}">
            <label class="form-label">Email Address</label>
            {% if register_form.email.errors %}
            <div class="text-danger small">{{ register_form.email.errors.0 }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            <input type="tel" class="form-input" name="phone_number" placeholder=" " required
              value="{{ register_form.phone_number.value|default:'' }}">
            <label class="form-label">Phone Number</label>
            {% if register_form.phone_number.errors %}
            <div class="text-danger small">{{ register_form.phone_number.errors.0 }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            {{ register_form.travel_style }}
            <label class="form-label" for="{{ register_form.travel_style.id_for_label }}">
              {{ register_form.travel_style.label }}
            </label>
            {% if register_form.travel_style.errors %}
            <div class="text-danger small">{{ register_form.travel_style.errors.0 }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            <input type="password" class="form-input" name="password1" placeholder=" " required>
            <label class="form-label">Password</label>
            {% if register_form.password1.errors %}
            <div class="text-danger small">{{ register_form.password1.errors.0 }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            <input type="password" class="form-input" name="password2" placeholder=" " required>
            <label class="form-label">Confirm Password</label>
            {% if register_form.password2.errors %}
            <div class="text-danger small">{{ register_form.password2.errors.0 }}</div>
            {% endif %}
          </div>

          <button type="submit" class="btn btn-primary">Create Account</button>
        </form>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Form Toggle Functionality
    const loginBtn = document.getElementById('showLoginBtn');
    const regBtn = document.getElementById('showRegisterBtn');
    const loginForm = document.getElementById('loginForm');
    const regForm = document.getElementById('registerForm');

    function toggleForms(showLogin) {
      loginBtn.classList.toggle('active', showLogin);
      regBtn.classList.toggle('active', !showLogin);
      loginForm.classList.toggle('active', showLogin);
      regForm.classList.toggle('active', !showLogin);
    }

    // Preserve active tab on page reload
    const activeForm = localStorage.getItem('activeForm') || 'loginForm';
    toggleForms(activeForm === 'loginForm');

    loginBtn.addEventListener('click', () => {
      localStorage.setItem('activeForm', 'loginForm');
      toggleForms(true);
    });

    regBtn.addEventListener('click', () => {
      localStorage.setItem('activeForm', 'registerForm');
      toggleForms(false);
    });

    // Initialize form labels and values
    document.querySelectorAll('.form-input').forEach(input => {
      // Set initial labels
      if (input.value) {
        input.dispatchEvent(new Event('input'));
      }

      // Handle dynamic updates
      input.addEventListener('input', function () {
        const label = this.parentNode.querySelector('.form-label');
        label.classList.toggle('active', this.value !== '');
      });
    });

    // Handle select elements
    document.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', function () {
        const label = this.parentNode.querySelector('.form-label');
        label.classList.toggle('active', this.value !== '');
      });
    });
  });
</script>
{% endblock %}